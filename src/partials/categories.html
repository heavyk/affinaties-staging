<link rel='ractive' href='../partials/spinner.html'>

<a class="categories-button {{class}}" on-click="toggle('menu')">
  {{#if selected}}
    [[#if typeof L.selected === 'string']]
      [[L.selected]]
    [[else]]
      Categor√≠a:&nbsp;
    [[/if]]
    {{selected.title}}
  {{else}}
    {{L.selector || 'Categories'}}
  {{/if}}
</a>
<div class="categories" style="display: {{menu ? 'block' : 'none'}}">
  {{#if loading}}
    <spinner scale="0.2" />
  {{/if loading}}

  {{#if error}}
    ERROR: {{error}}
  {{/if error}}

  {{#if categories}}
    {{#if L.unselect && selected}}
      <div class="category" on-click="clear" style="color: #f55">{{L.unselect}}</div>
    {{/if}}
    <!-- {{#each categories}}
      <div class="category" on-click="activate(event)">{{.title}}</div>
    {{/each categories}} -->
    <div class="categories-left">
      {{#each l1}}
        <div class="category" on-click="activate(event)">{{.title}}</div>
      {{/each l1}}
    </div>
    <div class="categories-right">
      {{#each l2}}
        <div class="category" on-click="activate(event)">{{.title}}</div>
      {{/each l2}}
    </div>
  {{/if categories}}
</div>


<style>
.categories-button {
  display: block;
  float: left;
  text-decoration: none;
  margin-top: 8px;
  padding: 2px 10px;
  cursor: pointer;
  height: 30px;
  background-color: #fff;
  color: #fd270d;
  font-size: 17px;
  border: solid 2px #fff;
  border: 0px solid #000000;
  font-weight: bold;
  top: 20px;
  border-radius: 20px 0px 20px 0px;
  border: 0px solid #000000;
  box-shadow: 5px 11px 20px -4px rgba(41, 41, 41, 0.53);
}
.categories {
  border-radius: 30px 9px 30px 9px;
  background-color: #ffffff;
  font-size: 13px;
  padding: 30px 0;
  width: 500px;
  box-shadow: 5px 11px 20px -4px rgba(41, 41, 41, 0.53);
}
div.category {
  cursor: pointer;
  font-size: 18px;
  font-weight: 400;
  padding-left: 50px;
  box-sizing: border-box;
  color: #000;
  /*width: 50%;*/
  /*float:left;*/
  text-align: left;
}
div.category:hover {
  background-color: #faa;
}
.categories-left, .categories-right {
  width: 50%;
  float: left;
}
</style>


<script>
let api = require('../api')
component.exports = {
  isolated: true,
  oninit () {
    this.set('loading', true)
    // TODO this can be a decorator
    let onclick = (e) => {
      let status = this.get('menu')
      if (!status) return
      let target = e.target
      let pEl = target
      do {
        if (pEl.className && pEl.className.indexOf('categories') === 0) return
      } while (pEl = pEl.parentNode)
      this.set('menu', false)
    }
    window.addEventListener('click', onclick, true)
    this.once('teardown', () => { window.removeEventListener('click', onclick, true) })
    api.category.until('/', () => {
      let list = api.category.list
      let len = Math.round(list.length / 2)
      let l1 = list.slice(0, len)
      let l2 = list.slice(len)
      this.set('categories', list)
      this.set('l1', l1)
      this.set('l2', l2)
      this.set('loading', false)
    })
    this.on('clear', () => {
      this.activate({context: null})
    })
    this.parent.on('set-category', (id) => {
      api.category.until('/', () => {
        this.set('selected', id ? api.category.get(id) : null)
      })
    })
  },
  activate (event, menu) {
    this.set('selected', event.context)
    this.fire('select', event.context)
    this.set('menu', menu || false)
  },
}
</script>
