/*************************
   Velocity jQuery Shim
*************************/

/*! VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/wiki/MIT_License. */

/* This file contains the jQuery functions that Velocity relies on, thereby removing Velocity's dependency on a full copy of jQuery, and allowing it to work in any environment. */
/* These shimmed functions are only used if jQuery isn't present. If both this shim and jQuery are loaded, Velocity defaults to jQuery proper. */
/* Browser support: Using this shim instead of jQuery proper removes support for IE8. */

/***************
     Setup
***************/

/* jQuery base. */
var $ = function (selector, context) {
  return new $.fn.init(selector, context)
}

/********************
   Private Methods
********************/

/* jQuery */
$.isWindow = function (obj) {
  /* jshint eqeqeq: false */
  return obj != null && obj == obj.window
}

/* jQuery */
$.type = function (obj) {
  if (obj == null) {
    return obj + ''
  }

  return typeof obj === 'object' || typeof obj === 'function' ?
    class2type[toString.call(obj)] || 'object' :
    typeof obj
}

/* jQuery */
$.isArray = Array.isArray || function (obj) {
  return $.type(obj) === 'array'
}

/* jQuery */
function isArraylike (obj) {
  var length = obj.length,
    type = $.type(obj)

  if (type === 'function' || $.isWindow(obj)) {
    return false
  }

  if (obj.nodeType === 1 && length) {
    return true
  }

  return type === 'array' || length === 0 || typeof length === 'number' && length > 0 && (length - 1) in obj
}

/***************
   $ Methods
***************/

/* jQuery: Support removed for IE<9. */
$.isPlainObject = function (obj) {
  var key

  if (!obj || $.type(obj) !== 'object' || obj.nodeType || $.isWindow(obj)) {
    return false
  }

  try {
    if (obj.constructor &&
      !hasOwn.call(obj, 'constructor') &&
      !hasOwn.call(obj.constructor.prototype, 'isPrototypeOf')) {
      return false
    }
  } catch (e) {
    return false
  }

  for (key in obj) {}

  return key === undefined || hasOwn.call(obj, key)
}

/* jQuery */
$.each = function (obj, callback, args) {
  var value,
    i = 0,
    length = obj.length,
    isArray = isArraylike(obj)

  if (args) {
    if (isArray) {
      for (; i < length; i++) {
        value = callback.apply(obj[i], args)

        if (value === false) {
          break
        }
      }
    } else {
      for (i in obj) {
        value = callback.apply(obj[i], args)

        if (value === false) {
          break
        }
      }
    }
  } else {
    if (isArray) {
      for (; i < length; i++) {
        value = callback.call(obj[i], i, obj[i])

        if (value === false) {
          break
        }
      }
    } else {
      for (i in obj) {
        value = callback.call(obj[i], i, obj[i])

        if (value === false) {
          break
        }
      }
    }
  }

  return obj
}

/* Custom */
$.data = function (node, key, value) {
  /* $.getData() */
  if (value === undefined) {
    var id = node[$.expando],
      store = id && cache[id]

    if (key === undefined) {
      return store
    } else if (store) {
      if (key in store) {
        return store[key]
      }
    }
  /* $.setData() */
  } else if (key !== undefined) {
    var id = node[$.expando] || (node[$.expando] = ++$.uuid)

    cache[id] = cache[id] || {}
    cache[id][key] = value

    return value
  }
}

/* Custom */
$.removeData = function (node, keys) {
  var id = node[$.expando],
    store = id && cache[id]

  if (store) {
    $.each(keys, function (_, key) {
      delete store[key]
    })
  }
}

/* jQuery */
$.extend = function () {
  var src, copyIsArray, copy, name, options, clone,
    target = arguments[0] || {},
    i = 1,
    length = arguments.length,
    deep = false

  if (typeof target === 'boolean') {
    deep = target

    target = arguments[i] || {}
    i++
  }

  if (typeof target !== 'object' && $.type(target) !== 'function') {
    target = {}
  }

  if (i === length) {
    target = this
    i--
  }

  for (; i < length; i++) {
    if ((options = arguments[i]) != null) {
      for (name in options) {
        src = target[name]
        copy = options[name]

        if (target === copy) {
          continue
        }

        if (deep && copy && ($.isPlainObject(copy) || (copyIsArray = $.isArray(copy)))) {
          if (copyIsArray) {
            copyIsArray = false
            clone = src && $.isArray(src) ? src : []
          } else {
            clone = src && $.isPlainObject(src) ? src : {}
          }

          target[name] = $.extend(deep, clone, copy)
        } else if (copy !== undefined) {
          target[name] = copy
        }
      }
    }
  }

  return target
}

/* jQuery 1.4.3 */
$.queue = function (elem, type, data) {
  function $makeArray (arr, results) {
    var ret = results || []

    if (arr != null) {
      if (isArraylike(Object(arr))) {
        /* $.merge */
        (function (first, second) {
          var len = +second.length,
            j = 0,
            i = first.length

          while (j < len) {
            first[i++] = second[j++]
          }

          if (len !== len) {
            while (second[j] !== undefined) {
              first[i++] = second[j++]
            }
          }

          first.length = i

          return first
        })(ret, typeof arr === 'string' ? [arr] : arr)
      } else {
        [].push.call(ret, arr)
      }
    }

    return ret
  }

  if (!elem) {
    return
  }

  type = (type || 'fx') + 'queue'

  var q = $.data(elem, type)

  if (!data) {
    return q || []
  }

  if (!q || $.isArray(data)) {
    q = $.data(elem, type, $makeArray(data))
  } else {
    q.push(data)
  }

  return q
}

/* jQuery 1.4.3 */
$.dequeue = function (elems, type) {
  /* Custom: Embed element iteration. */
  $.each(elems.nodeType ? [ elems ] : elems, function (i, elem) {
    type = type || 'fx'

    var queue = $.queue(elem, type),
      fn = queue.shift()

    if (fn === 'inprogress') {
      fn = queue.shift()
    }

    if (fn) {
      if (type === 'fx') {
        queue.unshift('inprogress')
      }

      fn.call(elem, function () {
        $.dequeue(elem, type)
      })
    }
  })
}

/******************
   $.fn Methods
******************/

/* jQuery */
$.fn = $.prototype = {
  init: function (selector) {
    /* Just return the element wrapped inside an array; don't proceed with the actual jQuery node wrapping process. */
    if (selector.nodeType) {
      this[0] = selector

      return this
    } else {
      throw new Error('Not a DOM node.')
    }
  },

  offset: function () {
    /* jQuery altered code: Dropped disconnected DOM node checking. */
    var box = this[0].getBoundingClientRect ? this[0].getBoundingClientRect() : { top: 0, left: 0 }

    return {
      top: box.top + (window.pageYOffset || document.scrollTop || 0) - (document.clientTop || 0),
      left: box.left + (window.pageXOffset || document.scrollLeft || 0) - (document.clientLeft || 0)
    }
  },

  position: function () {
    /* jQuery */
    function offsetParent () {
      var offsetParent = this.offsetParent || document

      while (offsetParent && (!offsetParent.nodeType.toLowerCase === 'html' && offsetParent.style.position === 'static')) {
        offsetParent = offsetParent.offsetParent
      }

      return offsetParent || document
    }

    /* Zepto */
    var elem = this[0],
      offsetParent = offsetParent.apply(elem),
      offset = this.offset(),
      parentOffset = /^(?:body|html)$/i.test(offsetParent.nodeName) ? { top: 0, left: 0 } : $(offsetParent).offset()

    offset.top -= parseFloat(elem.style.marginTop) || 0
    offset.left -= parseFloat(elem.style.marginLeft) || 0

    if (offsetParent.style) {
      parentOffset.top += parseFloat(offsetParent.style.borderTopWidth) || 0
      parentOffset.left += parseFloat(offsetParent.style.borderLeftWidth) || 0
    }

    return {
      top: offset.top - parentOffset.top,
      left: offset.left - parentOffset.left
    }
  }
}

/**********************
   Private Variables
**********************/

/* For $.data() */
var cache = {}
$.expando = 'velocity' + (new Date().getTime())
$.uuid = 0

/* For $.queue() */
var class2type = {},
  hasOwn = class2type.hasOwnProperty,
  toString = class2type.toString

var types = 'Boolean Number String Function Array Date RegExp Object Error'.split(' ')
for (var i = 0; i < types.length; i++) {
  class2type['[object ' + types[i] + ']'] = types[i].toLowerCase()
}

/* Makes $(node) possible, without having to call init. */
$.fn.init.prototype = $.fn

export default $
